# DungeonTools マニュアル（Windows）

DungeonTools は、**Dungeon of the Living Will** に付属する編集ツールです。
キャラクター画像の作成・編集、ダンジョンパッケージ作成、カスタムインストラクション管理、AI設定（APIキー等）を行えます。

---

## 1. 起動方法

### 1-1. ゲームから起動（推奨）
- `Dungeon_of_the_Living_Will.exe` を起動
- オープニング画面の「Tools」等から `DungeonTools.exe` を起動

### 1-2. 単体で起動
- 配布物内の `DungeonTools.exe` を直接起動

#### 配布物の場所について
- 配布物は通常、`Dungeon_of_the_Living_Will.exe` が入っているフォルダ（ゲーム本体フォルダ）に、`DungeonTools.exe` も同梱されています。
  - 例: `Dungeon_of_the_Living_Will/` フォルダの中に両方がある
- もし見つからない場合は、配布ZIPを展開したフォルダ内を検索してください（`DungeonTools.exe`）。

起動すると、PC上でローカルWebサーバーが立ち上がり、ブラウザにツール画面が表示されます。

---

## 2. 画面の見方（左メニュー / Pages）

ツールは Streamlit の Multi‑Page 構成です。
左側の **Pages** メニューから、以下のページに移動できます。

- **設定**: APIキー / モデル名 / Base URL の保存
- **キャラクター**: キャラPNGの作成・タグ/プロフィール/スキル等の埋め込み保存
- **ダンジョン**: ダンジョンパッケージ作成（`assets/dungeons/<ダンジョン名>/`）
- **カスタムインストラクション**: AIの振る舞いを調整するJSONの作成・編集

---

## 3. まず最初に（AI APIキーの準備）

AI機能（タグ生成/プロフィール生成/作劇方針生成など）を使う場合は、事前に **APIキーを取得** してください。
取得したキーは **ツールの「設定」ページから入力・保存** できます（環境変数の事前設定は不要です）。

- OpenAI: https://platform.openai.com/
- xAI: https://console.x.ai/

---

## 4. 設定ページ（APIキー / モデル名 / Base URL）

**設定**ページでは以下を保存できます。

- **APIキー（OpenAI互換 / xAIなど）**
- **モデル名**（利用したいモデル名を入力）
- **Base URL**（OpenAI互換APIのエンドポイント）
  - 例: `https://api.openai.com/v1`
  - 例: `https://api.x.ai/v1`

### 保存先について（重要）
- APIキー等は OS のキーチェーン（`keyring`）に保存されます。
  - Windowsの場合は概ね「資格情報マネージャー」に保存され、プロジェクト配下に平文で書かれる設計ではありません。

---

## 5. キャラクターページ

キャラクターの画像（PNG）に、以下の情報を埋め込んで保存できます。

- 名前 / プロフィール
- タグ（英単語/短い句）
- スキル（名称/効果）
- 最大HP/MP/SP

### 保存先
- 共通キャラは通常 `assets/characters/` に保存されます（`<名前>.png`）。
- ダンジョン同梱キャラを編集した場合、
  **「ダンジョン同梱キャラは元ファイルへ上書き保存」** を有効にすると、元PNGへ上書きできます。

---

## 6. ダンジョンページ

ダンジョンパッケージ（フォルダ）を作成・保存できます。

### 保存先（パッケージ構造）
`assets/dungeons/<ダンジョン名>/` に以下を作成します。

- `dungeon.json`
- `image.png`
- `wall.png` / `door.png` / `bg.png`
- （必要に応じて）`キャラクター/` 配下に同梱キャラPNG

### フォルダ名の注意
ダンジョン名はフォルダ名として使われます。Windowsで使えない文字（`\ / : * ? " < > |`）は使用できません。

---

## 7. カスタムインストラクションページ

AI GMの出力の雰囲気や運用方針を調整する「カスタムインストラクション」を作成・編集できます。

### 保存先
- `assets/instructions/` にJSONとして保存されます。

---

## 8. トラブルシューティング

### 8-1. ツールを起動しても画面が出ない
- セキュリティソフト/ファイアウォールがローカル通信をブロックしていないか確認してください。
- ツールは `127.0.0.1` のローカルポートを使用します。
  - 既定では **8502〜8512** の範囲で空いているポートを自動選択します。

### 8-2. ポートを指定して起動したい
- コマンドライン引数でポート番号を指定できます。
  - 例: `DungeonTools.exe 8503`

---

## 9. 補足（開発者向け）

ソースコードから起動する場合は `run_tools.bat`（venv自動構築）も利用できますが、
配布版では `DungeonTools.exe` の使用を想定しています。
