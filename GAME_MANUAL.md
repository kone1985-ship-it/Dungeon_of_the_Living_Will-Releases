# Dungeon of the Living Will（ゲーム本編マニュアル）

この文書は、Arcade 製のゲーム本編（探索・戦闘）に必要な操作をまとめたものです。
キャラクター作成やダンジョン編集は、別アプリの DungeonTools を使います（後述）。

## 画面の流れ

1. オープニング
2. 仲間選択（パーティ編成）
3. ダンジョン選択（迷宮） / 対戦相手選択（対戦）
4. ダンジョン探索（迷宮） / 戦闘（対戦）

---

## オープニング

- 画面のボタン
  - **ゲーム開始**：仲間選択へ
  - **編集ツール起動**：DungeonTools（同梱されている場合）を起動

---

## 仲間選択（パーティ編成）

- **上側**：キャラクター一覧（クリックで選択/解除）
- **左下**：選択済みパーティ（最大3人）

### 操作

- キャラクターをクリックして選択
  - 最大 **3人** まで
  - 4人目を選ぶと、**最も古く選んだキャラが外れて入れ替え**になります
- 左下の「選択済みサムネ」をクリックすると、そのキャラを外せます
- マウスホイールでキャラクター一覧をスクロールできます
- 右下のボタン
  - **迷宮**：ダンジョン選択へ（1人以上選ぶと押せます）
  - **対戦**：対戦相手（敵）選択へ（1人以上選ぶと押せます）
  - **戻る**：オープニングへ

### 追加指示（任意）

右下の **「デフォルト作劇」ボタン**は、クリックするたびに作劇方針（カスタムインストラクション）を循環選択します。

- デフォルト作劇：追加指示なし
- カスタムインストラクション：DungeonTools で作成した指示

---

## 対戦モード

パーティ（味方）を選んだあと、**迷宮に潜らずに戦闘だけを行う**モードです。

### 流れ

1. 仲間選択で味方を1人以上選ぶ
2. 右下の **「対戦」** を押す
3. 対戦相手（敵）を選ぶ（1〜3体）
4. 右下の **「開始」** を押す → そのまま戦闘に入ります

### 敵の選び方

- 敵候補は `assets/characters/` のキャラクター画像から読み込まれます。
- 1〜3体まで選択できます。
- 4体目を選ぶと、**最も古く選んだ相手が外れて入れ替え**になります。

### 対戦中の操作

- 基本的には通常の戦闘と同じです。
  - 右側の入力欄と送信ボタン、または選択肢ボタンで進行します。

### 対戦の終了

- 決着後に短い「余韻」の描写が入り、その後は選択肢が **「終了」** のみになります。
- **「終了」** を選ぶと仲間選択へ戻ります。

### うまく始まらない場合

- 対戦開始時に「対戦用ダンジョンが見つかりません」と出る場合、`assets/dungeons/対戦場/` が不足しています。
  - 配布物（ゲーム本体フォルダ）に同梱されているか確認してください。

---

## ダンジョン選択

### 操作（キーボード）

- `A` / `D` または `←` / `→`：ダンジョンを切り替え

### 操作（ボタン）

右側のボタンからも操作できます。

- **詳しく見る**：選択中ダンジョンの説明を表示
- **このダンジョンで開始**：探索開始
- **戻る**：仲間選択へ

---

## ダンジョン探索（探索/戦闘）

画面は大きく3つです。

- **左上**：3D 風の探索ビュー（移動/方向転換の結果が反映されます）
- **左下**：パーティ表示
- **右側**：状況ログ、入力欄、送信ボタン、選択肢ボタン

### 基本操作（移動・方向転換）

- 方向転換
  - `A` / `←`：左を向く
  - `D` / `→`：右を向く
- 移動
  - `W` / `↑`：前進
  - `S` / `↓`：後退
- ミニマップ表示
  - `M`：オートマップの表示/非表示

### 行動の入力（右側）

- 右側の入力欄に行動を書いて、**送信**ボタンで確定します
- 入力が空のまま送信すると、`続けて` として送信されます

補足（開発者向け/非常用）
- 入力欄に `exit` または `q` を送ると、ゲームを終了します

### 選択肢ボタン

右下に選択肢が出ているときは、**ボタンをクリック**して進められます。
（戦闘やイベントの進行は、ここに出る選択肢を使う想定です）

### スクロール

- 右側ログはマウスホイールでスクロールできます

### 階段（下の階へ）

状況によって階段の選択肢が提示されます。
選択肢ボタン、または自由入力で **「降りる」「下りる」** を含む行動を送信すると、次の階へ進みます。

- 例：`降りる` / `階段を降りる`
- `降りない` / `下りない` などを選ぶと、その階では階段を強制しない扱いになります

---

## 操作できない/反応しないとき

### 移動キーが効かない

次の状態だと移動/方向転換が抑止されます。

- **AIの応答待ち中**（処理中）
- **入力欄がフォーカス中**
  - 対処：入力欄以外（左側の探索ビューや右側ログ枠など）をクリックしてフォーカスを外してください
- **戦闘モード中**：移動/方向転換はできません（選択肢・入力で進行してください）
- **NPC が残っている状態**（イベント等で `persist` な NPC がいるとき）
  - 移動/階段移動が制限されることがあります

---

## 編集ツール（DungeonTools）について

オープニングの **「編集ツール起動」** から DungeonTools を起動できます（同梱されている場合）。
キャラクター作成・ダンジョン作成・カスタムインストラクション作成は、こちらで行います。

- 使い方は [DUNGEONTOOLS_MANUAL.md](DUNGEONTOOLS_MANUAL.md) を参照してください
